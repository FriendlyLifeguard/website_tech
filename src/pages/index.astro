---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import PostPreview from "@/components/blog/PostPreview";
import SocialList from "@/components/SocialList";
import { sortMDByDate } from "@/utils";

const MAX_POSTS = 10;
const allPosts = await getCollection("post", ({ data }) => {
	return !data.draft;  // Only get non-draft posts
});
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
---

<PageLayout meta={{ title: "Home" }}>
	<section class="flex flex-row items-start gap-8 mb-4">
		<img 
			src="/mainImage.png"
			alt="Alan Kang"
			class="w-40 h-40 rounded-lg border-2 border-accent/20 hidden sm:block" 
		/>
		<div class="flex-1">
			<h1 class="title mb-2 text-2xl font-bold">Hi, I'm Alan :^)</h1>
			<p class="mb-4 text-base">I like to read, contribute and write about crypto. Currently, I do open source contributions in the Starknet ecosystem. I research on the side to learn about latest protocol developments and smart contract security.</p>
		</div>
	</section>

	<div class="space-y-8">
		<section>
			<div class="bg-accent/5 rounded-lg p-4">
				<h2 class="text-2xl font-bold text-accent mb-4">Open Source Work</h2>
				
				<div class="flex flex-wrap gap-2 mb-4">
					<button class="project-btn px-4 py-1.5 rounded-full text-sm bg-accent/10 hover:bg-accent/20 active" data-project="Cairo Book">Cairo Book</button>
					<button class="project-btn px-4 py-1.5 rounded-full text-sm bg-accent/10 hover:bg-accent/20" data-project="Orion">Orion</button>
					<button class="project-btn px-4 py-1.5 rounded-full text-sm bg-accent/10 hover:bg-accent/20" data-project="StarknetBook">StarknetBook</button>
					<button class="project-btn px-4 py-1.5 rounded-full text-sm bg-accent/10 hover:bg-accent/20" data-project="Ekubo">Ekubo</button>
				</div>

				<div class="project-content bg-white/50 dark:bg-black/10 rounded-lg p-3 shadow-sm" data-project="Cairo Book">
					<ul class="divide-y divide-accent/10">
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/1107" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-yellow-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Added Memory Model section</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/871" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Added Recursion and loop explanation</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/938" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Reworked copy trait explanation</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/959" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Reworked byte array description</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/754" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Added smart contract testing section</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/cairo-book/cairo-book/pull/544" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Syntax fix in dispatcher-library section</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
					</ul>
				</div>

				<div class="project-content bg-white/50 dark:bg-black/10 rounded-lg p-3 shadow-sm hidden" data-project="Orion">
					<ul class="divide-y divide-accent/10">
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/gizatechxyz/orion/pull/528" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Implemented ReduceLogSumExp operator</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
					</ul>
				</div>

				<div class="project-content bg-white/50 dark:bg-black/10 rounded-lg p-3 shadow-sm hidden" data-project="StarknetBook">
					<ul class="divide-y divide-accent/10">
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/starknet-edu/starknetbook/pull/369" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs">Merged</div>
								<span class="group-hover:text-accent transition-colors duration-200">Updated Chapter Starknet-js: Javascript SDK section</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
					</ul>
				</div>

				<div class="project-content bg-white/50 dark:bg-black/10 rounded-lg p-3 shadow-sm hidden" data-project="Ekubo">
					<ul class="divide-y divide-accent/10">
						<li class="hover:bg-accent/10 rounded-md group transition-all duration-200">
							<a href="https://github.com/EkuboProtocol/starknet-indexer/pull/21" 
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-2 p-2 cursor-pointer text-textColor">
								<div class="flex-shrink-0 px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 text-xs">In Review</div>
								<span class="group-hover:text-accent transition-colors duration-200">Generate candlestick data from oracle_snapshots table</span>
								<svg class="w-4 h-4 text-accent/50 group-hover:text-accent ml-auto transition-colors duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</section>

		<section>
			<div class="bg-accent/5 rounded-lg p-4">
				<div class="flex justify-between items-center mb-4">
					<h2 class="text-2xl font-bold text-accent">Latest Posts</h2>
					<a href="/posts" class="text-sm text-accent hover:text-accent/80 transition-colors duration-200">
						View All â†’
					</a>
				</div>
				
				<div class="bg-white/50 dark:bg-black/10 rounded-lg p-3 shadow-sm">
					<ul class="divide-y divide-accent/10">
						{
							allPostsByDate.map((p) => (
								<li class="py-2 hover:bg-accent/5 rounded-md">
									<PostPreview post={p} />
								</li>
							))
						}
					</ul>
				</div>
			</div>
		</section>
	</div>

	<section class="mt-16">
		<SocialList />
	</section>
</PageLayout>

<style>
	.project-btn.active {
		@apply bg-accent text-white;
	}
</style>

<script>
	function setupProjectTabs() {
		const buttons = document.querySelectorAll('.project-btn');
		const contents = document.querySelectorAll('.project-content');

		buttons.forEach(button => {
			button.addEventListener('click', () => {
				// Remove active class from all buttons
				buttons.forEach(b => b.classList.remove('active'));
				// Add active class to clicked button
				button.classList.add('active');

				// Hide all project contents
				contents.forEach(content => {
					content.classList.add('hidden');
				});

				// Show the selected project content
				const selectedProject = button.getAttribute('data-project');
				const selectedContent = document.querySelector(`.project-content[data-project="${selectedProject}"]`);
				if (selectedContent) {
					selectedContent.classList.remove('hidden');
				}
			});
		});
	}

	// Initialize on page load
	setupProjectTabs();
	// Re-initialize after view transitions
	document.addEventListener('astro:page-load', setupProjectTabs);
</script>
